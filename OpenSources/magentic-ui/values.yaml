# Default values for magentic-ui
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Replica count for the magentic-ui backend
# Note: Due to Docker-in-Docker requirements, scaling beyond 1 replica
# requires additional configuration for shared volumes and session management
replicaCount: 1

# Container image configuration
# magentic-ui backend (Python FastAPI application)
image:
  repository: ghcr.io/microsoft/magentic-ui
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion (0.1.2)
  tag: ""

# Browser container configuration (used for web automation)
browserImage:
  repository: ghcr.io/microsoft/magentic-ui-browser
  tag: "0.0.1"
  pullPolicy: IfNotPresent

# Python execution environment container (used for code execution)
pythonEnvImage:
  repository: ghcr.io/microsoft/magentic-ui-python-env
  tag: "0.0.1"
  pullPolicy: IfNotPresent

# Image pull secrets for private registries
imagePullSecrets: []

# Override chart name
nameOverride: ""
fullnameOverride: ""

# Magentic-UI Configuration
magneticUI:
  # OpenAI API Configuration
  openai:
    # API Key for OpenAI (required)
    # Can be set via existing secret or direct value
    apiKey: ""
    # Use existing secret for API key
    existingSecret: ""
    existingSecretKey: "apikey"
    # Base URL for OpenAI API (optional, for Azure OpenAI or custom endpoints)
    baseUrl: ""
    # Model to use
    model: "gpt-4o-2024-08-06"
  
  # Application configuration
  config:
    # Port for the web UI
    port: 8081
    # Host to bind to
    host: "0.0.0.0"
    # Number of uvicorn workers
    workers: 1
    # Enable API documentation
    docs: true
    # Run without Docker (disables code execution and live browser view)
    runWithoutDocker: false
    
  # Workspace configuration
  workspace:
    # Persistent storage for user data, sessions, and plans
    enabled: true
    # Storage class (leave empty for cluster default)
    storageClass: ""
    # Storage size
    size: 10Gi
    # Access mode
    accessMode: ReadWriteOnce

# This section builds out the service account more information can be found here: https://kubernetes.io/docs/concepts/security/service-accounts/
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# This is for setting Kubernetes Annotations to a Pod.
# For more information checkout: https://kubernetes.io/docs/concepts/overview/working-with-objects/annotations/
podAnnotations: {}
# This is for setting Kubernetes Labels to a Pod.
# For more information checkout: https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/
podLabels: {}

podSecurityContext: {}
  # fsGroup: 2000
  # Note: magentic-ui pods require privileged mode for Docker-in-Docker

# Service configuration
service:
  type: ClusterIP
  # Main web UI port
  port: 8081
  # noVNC port for browser view
  novncPort: 6080
  # Playwright WebSocket port
  playwrightPort: 37367

# Ingress configuration
ingress:
  enabled: false
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "600"
    # WebSocket support for noVNC and Playwright
    nginx.ingress.kubernetes.io/websocket-services: "magentic-ui"
  hosts:
    - host: magentic-ui.example.com
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: magentic-ui
              port: 8081
  tls: []
  #  - secretName: magentic-ui-tls
  #    hosts:
  #      - magentic-ui.example.com

# Resource limits and requests
# Magentic-UI requires significant resources due to browser automation and code execution
resources:
  limits:
    cpu: 4000m
    memory: 8Gi
  requests:
    cpu: 2000m
    memory: 4Gi

# Health check probes
livenessProbe:
  httpGet:
    path: /api/health
    port: 8081
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /api/health
    port: 8081
  initialDelaySeconds: 15
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3

# Autoscaling configuration
# Note: Due to Docker-in-Docker and session state management,
# horizontal scaling requires additional configuration
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 75

# Additional volumes
volumes: []
# - name: custom-config
#   configMap:
#     name: magentic-ui-config

# Additional volume mounts
volumeMounts: []
# - name: custom-config
#   mountPath: /app/config
#   readOnly: true

# Node selector
nodeSelector: {}
# Example: Run on nodes with SSD
# disktype: ssd

# Tolerations
tolerations: []
# Example: Tolerate nodes with high memory taint
# - key: "high-memory"
#   operator: "Equal"
#   value: "true"
#   effect: "NoSchedule"

# Affinity rules
affinity: {}
# Example: Prefer nodes with GPU
# nodeAffinity:
#   preferredDuringSchedulingIgnoredDuringExecution:
#   - weight: 100
#     preference:
#       matchExpressions:
#       - key: accelerator
#         operator: In
#         values:
#         - nvidia-gpu

# Security context for pods
# Note: magentic-ui requires privileged mode for Docker-in-Docker
securityContext:
  privileged: true
  capabilities:
    add:
      - SYS_ADMIN

# Database configuration (optional, defaults to SQLite)
database:
  # Type: sqlite or postgresql
  type: sqlite
  # PostgreSQL configuration (if type is postgresql)
  postgresql:
    host: ""
    port: 5432
    database: "magneticui"
    username: "magneticui"
    # Existing secret for database password
    existingSecret: ""
    existingSecretKey: "password"
    # Direct password (not recommended for production)
    password: ""
